<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Buildings Visualization - Sector6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { width: 100%; height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script>
const MIN_HEIGHT = 25.4807;   // lowest building
const MAX_HEIGHT = 46.9226;   // tallest building
const MAX_EXTRUSION = 18;     // max extrusion for G+5

const map = new maplibregl.Map({
    container: 'map',
    style: {
        version: 8,
        sources: {
            'osm-tiles': {
                type: 'raster',
                tiles: ['https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'],
                tileSize: 256
            }
        },
        layers: [
            { id: 'osm-layer', type: 'raster', source: 'osm-tiles' }
        ]
    },
    center: [85.84, 20.47],
    zoom: 17,
    pitch: 60,
    bearing: -17.6
});

map.on('load', () => {
    map.addSource('buildings', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/hemanya2003/CDA-Buildings/main/buildings.geojson'
    });

    // 3D buildings layer with proportional height + floor-based smooth colors
    map.addLayer({
        id: 'buildings-3d',
        type: 'fill-extrusion',
        source: 'buildings',
        paint: {
            'fill-extrusion-height': [
                '*',
                ['/', ['-', ['get', 'HEIGHT'], MIN_HEIGHT], MAX_HEIGHT - MIN_HEIGHT],
                MAX_EXTRUSION
            ],
            'fill-extrusion-base': 0,
            'fill-extrusion-opacity': 0.9,
            'fill-extrusion-color': [
                'interpolate',
                ['linear'],
                ['get', 'HEIGHT'],
                MIN_HEIGHT, 'royalblue',      // G+1 start
                34.2136, 'royalblue',         // G+1 end
                34.2136, 'lightgrey',         // G+2 start
                39.1755, 'lightgrey',         // G+2 end
                39.1755, 'lightblue',         // G+3 start
                40.2938, 'lightblue',         // G+3 end
                40.2938, 'orange',            // G+4 start
                43.054699, 'orange',          // G+4 end
                43.054699, 'red',             // G+5 start
                MAX_HEIGHT, 'red'             // G+5 end
            ]
        }
    });

    // Popup showing HEIGHT and approximate floors
    map.on('click', 'buildings-3d', (e) => {
        const height = e.features[0].properties.HEIGHT;
        const floors = Math.round(((height - MIN_HEIGHT) / (MAX_HEIGHT - MIN_HEIGHT)) * 5) + 1;
        new maplibregl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`<strong>HEIGHT:</strong> ${height.toFixed(2)} m<br><strong>Approx Floors:</strong> G+${floors}`)
            .addTo(map);
    });

    // Cursor pointer on hover
    map.on('mouseenter', 'buildings-3d', () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', 'buildings-3d', () => map.getCanvas().style.cursor = '');
});
</script>
</body>
</html>
