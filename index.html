<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Buildings Visualization - Sector6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MapLibre GL CSS -->
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { width: 100%; height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<!-- MapLibre GL JS -->
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script>
    const map = new maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                'osm-tiles': {
                    type: 'raster',
                    tiles: ['https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'],
                    tileSize: 256
                }
            },
            layers: [
                {
                    id: 'osm-layer',
                    type: 'raster',
                    source: 'osm-tiles'
                }
            ]
        },
        center: [85.84, 20.47], // Sector6 coordinates
        zoom: 17,
        pitch: 60,
        bearing: -17.6
    });

    map.on('load', () => {
        // Add buildings GeoJSON
        map.addSource('buildings', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/hemanya2003/CDA-Buildings/main/buildings.geojson'
        });

        // Add 3D extrusion layer with scaled heights
        map.addLayer({
            id: 'buildings-3d',
            type: 'fill-extrusion',
            source: 'buildings',
            paint: {
                'fill-extrusion-color': [
                    'step',
                    ['get', 'HEIGHT'],
                    'royalblue',  // 25–31
                    31, 'lightgrey',  // 31–37
                    37, 'lightblue',  // 37–43
                    43, 'red'         // 43+
                ],
                'fill-extrusion-height': ['*', ['get', 'HEIGHT'], 0.6], 
                'fill-extrusion-base': 0,
                'fill-extrusion-opacity': 0.9
            }
        });

        // Add popup on click
        map.on('click', 'buildings-3d', (e) => {
            const height = e.features[0].properties.HEIGHT;
            new maplibregl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(`<strong>HEIGHT:</strong> ${height} m`)
                .addTo(map);
        });

        // Change cursor to pointer when hovering over buildings
        map.on('mouseenter', 'buildings-3d', () => {
            map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseleave', 'buildings-3d', () => {
            map.getCanvas().style.cursor = '';
        });
    });
</script>
</body>
</html>
