<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Buildings Visualization - Sector6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MapLibre GL CSS -->
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { width: 100%; height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<!-- MapLibre GL JS -->
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<script>
const map = new maplibregl.Map({
    container: 'map',
    style: {
        version: 8,
        sources: {
            'osm-tiles': {
                type: 'raster',
                tiles: ['https://a.tile.openstreetmap.org/{z}/{x}/{y}.png'],
                tileSize: 256
            }
        },
        layers: [
            {
                id: 'osm-layer',
                type: 'raster',
                source: 'osm-tiles'
            }
        ]
    },
    center: [85.84, 20.47], // Sector6 coordinates
    zoom: 17,
    pitch: 60,
    bearing: -17.6
});

map.on('load', () => {
    // Add buildings GeoJSON
    map.addSource('buildings', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/hemanya2003/CDA-Buildings/main/buildings.geojson'
    });

    // Add 3D extrusion layer with realistic heights
    map.addLayer({
        id: 'buildings-3d',
        type: 'fill-extrusion',
        source: 'buildings',
        paint: {
            'fill-extrusion-color': [
                'step',
                ['get', 'HEIGHT'],
                'royalblue', 34.2136,   // G+1
                'lightgrey', 39.1755,   // G+2
                'lightblue', 40.2938,   // G+3
                'orange', 43.054699,    // G+4
                'red'                   // G+5
            ],
            'fill-extrusion-height': [
                'case',
                ['<=', ['get', 'HEIGHT'], 34.2136], 6,     // G+1
                ['<=', ['get', 'HEIGHT'], 39.1755], 9,     // G+2
                ['<=', ['get', 'HEIGHT'], 40.2938], 12,    // G+3
                ['<=', ['get', 'HEIGHT'], 43.054699], 15,  // G+4
                ['<=', ['get', 'HEIGHT'], 46.9226], 18,    // G+5
                6                                           // fallback
            ],
            'fill-extrusion-base': 0,
            'fill-extrusion-opacity': 0.9
        }
    });

    // Add popup on click showing HEIGHT and floors
    map.on('click', 'buildings-3d', (e) => {
        const height = e.features[0].properties.HEIGHT;
        let floors = '';
        if(height <= 34.2136) floors = 'G+1';
        else if(height <= 39.1755) floors = 'G+2';
        else if(height <= 40.2938) floors = 'G+3';
        else if(height <= 43.054699) floors = 'G+4';
        else if(height <= 46.9226) floors = 'G+5';
        else floors = 'Unknown';

        new maplibregl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`<strong>HEIGHT:</strong> ${height} m<br><strong>Floors:</strong> ${floors}`)
            .addTo(map);
    });

    // Change cursor to pointer on hover
    map.on('mouseenter', 'buildings-3d', () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', 'buildings-3d', () => map.getCanvas().style.cursor = '');
});
</script>
</body>
</html>
